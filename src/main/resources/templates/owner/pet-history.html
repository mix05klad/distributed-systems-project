<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="el">
<head>
  <meta charset="UTF-8">
  <title>Pet Medical History</title>
</head>
<body>

<h2>Pet Medical History</h2>

<div th:if="${errorMessage}">
  <p th:text="${errorMessage}" style="color:red;"></p>
</div>

<form th:action="@{/ui/owner/pet-history}" method="get">
  <div>
    <label>Pet</label>
    <select name="petId">
      <option value="" disabled
              th:selected="${selectedPetId == null}">
        -- Select pet --
      </option>
      <option th:each="p : ${pets}"
              th:value="${p.id}"
              th:text="${p.name}"
              th:selected="${selectedPetId != null and selectedPetId == p.id}">
      </option>
    </select>
  </div>

  <div>
    <label>Visit type</label>
    <select name="visitType">
      <option value="" th:selected="${selectedVisitType == null}">
        All types
      </option>
      <option th:each="t : ${allVisitTypes}"
              th:value="${t}"
              th:text="${t}"
              th:selected="${selectedVisitType != null and selectedVisitType == t}">
      </option>
    </select>
  </div>

  <div>
    <button type="submit">Show history</button>
  </div>
</form>

<hr/>

<!-- Card με βασικά στοιχεία pet -->
<div th:if="${selectedPetId != null && selectedPetName != null}"
     style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
  <h3 th:text="${selectedPetName}">Pet name</h3>
  <p>
    <span>Type: </span>
    <span th:text="${selectedPetType != null ? selectedPetType : 'N/A'}">type</span>
  </p>
  <p>
    <span>Age: </span>
    <span th:text="${selectedPetAge != null ? selectedPetAge : 'N/A'}">age</span>
  </p>
  <p>
    <span>Total completed visits: </span>
    <span th:text="${historyCount}">0</span>
  </p>
</div>

<div th:if="${history != null and !history.isEmpty()}">
  <table border="1">
    <tr>
      <th>Date / Time</th>
      <th>Vet</th>
      <th>Visit type</th>
      <th>Status</th>
      <th>Notes</th>
    </tr>
    <tr th:each="a : ${history}">
      <td th:text="${#temporals.format(a.startTime, 'dd/MM/yyyy HH:mm')}">date</td>
      <td th:text="${a.vetName}">vet</td>
      <td th:text="${a.visitType}">type</td>
      <td th:text="${a.status}">status</td>
      <td th:text="${a.vetNotes != null ? a.vetNotes : ''}">notes</td>
    </tr>
  </table>
</div>

<div th:if="${selectedPetId != null and (history == null or history.isEmpty())}">
  <p>No completed visits for this pet yet (with the selected filter).</p>
</div>

<div th:if="${selectedPetId == null}">
  <p>Please select a pet to view its medical history.</p>
</div>

<p>
  <button type="button" onclick="location.href='/ui/owner/home'">
    Back to Dashboard
  </button>
</p>

</body>
</html>
